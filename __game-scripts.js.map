{"version":3,"sources":["Scripts/hdr-lightmap.js","Scripts/Events/events-button.js","Scripts/Events/events-vr.js","Scripts/Events/events-keyboard.js","Scripts/Actions/action-vr.js","Scripts/Actions/action-set-property.js","Scripts/Camera/first-person-camera.js"],"names":[],"mappings":"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","sourcesContent":["// hdr-lightmap.js\nvar HdrLightmap = pc.createScript('hdrLightmap');\n\nHdrLightmap.attributes.add('shaderChunk', { type: 'asset', assetType: 'shader' });\n\nHdrLightmap.prototype.initialize = function () {\n    var renders = this.entity.findComponents('render');\n    for (var i = 0; i < renders.length; ++i) {\n        var meshInstances = renders[i].meshInstances;\n        for (var j = 0; j < meshInstances.length; j++) {\n            var mat = meshInstances[j].material;\n            mat.chunks.lightmapSinglePS = this.shaderChunk.resource;\n            mat.update();\n        }\n    }  \n};\n\n\n","// events-button.js\nvar EventsButton = pc.createScript('eventsButton');\n\nEventsButton.attributes.add('clickEvent', { type: 'string' });\nEventsButton.attributes.add('pressedStartEvent', { type: 'string' });\nEventsButton.attributes.add('pressedEndEvent', { type: 'string' });\nEventsButton.attributes.add('hoverStartEvent', { type: 'string' });\nEventsButton.attributes.add('hoverEndEvent', { type: 'string' });\n\n// initialize code called once per entity\nEventsButton.prototype.initialize = function() {\n    this.entity.button.on('click', function () {\n        if (this.clickEvent && this.clickEvent.length > 0) {\n            this.app.fire(this.clickEvent);\n        }\n    }, this);\n    this.entity.button.on('pressedstart', function () {\n        if (this.pressedStartEvent && this.pressedStartEvent.length > 0) {\n            this.app.fire(this.pressedStartEvent);\n        }\n    }, this);\n    this.entity.button.on('pressedend', function () {\n        if (this.pressedEndEvent && this.pressedEndEvent.length > 0) {\n            this.app.fire(this.pressedEndEvent);\n        }\n    }, this);\n    this.entity.button.on('hoverstart', function () {\n        if (this.hoverStartEvent && this.hoverStartEvent.length > 0) {\n            this.app.fire(this.hoverStartEvent);\n        }\n    }, this);\n    this.entity.button.on('hoverend', function () {\n        if (this.hoverEndEvent && this.hoverEndEvent.length > 0) {\n            this.app.fire(this.hoverEndEvent);\n        }\n    }, this);\n};\n\n\n","// events-vr.js\nvar EventsVr = pc.createScript('eventsVr');\n\nEventsVr.attributes.add('availableEvent', {\n    type: 'string',\n    default: 'vr:available',\n    title: 'Available Event',\n    description: 'Fired when a VR session becomes available.'\n});\nEventsVr.attributes.add('unavailableEvent', {\n    type: 'string',\n    default: 'vr:unavailable',\n    title: 'Unvailable Event',\n    description: 'Fired when a VR session becomes unavailable.'\n});\nEventsVr.attributes.add('startEvent', {\n    type: 'string',\n    default: 'vr:started',\n    title: 'Start Event',\n    description: 'Fired when a VR session starts.'\n});\nEventsVr.attributes.add('endEvent', {\n    type: 'string',\n    default: 'vr:ended',\n    title: 'End Event',\n    description: 'Fired when a VR session starts.'\n});\n\n// initialize code called once per entity\nEventsVr.prototype.initialize = function() {\n    this.app.xr.on('available:' + pc.XRTYPE_VR, function (available) {\n        this.app.fire(available ? this.availableEvent : this.unavailableEvent);\n    }, this);\n    this.app.xr.on('start', function () {\n        this.app.fire(this.startEvent);\n    }, this);\n    this.app.xr.on('end', function () {\n        this.app.fire(this.endEvent);\n    }, this);\n};\n\nEventsVr.prototype.postInitialize = function() {\n    if (this.app.xr.supported && !this.app.xr.active) {\n        var available = this.app.xr.isAvailable(pc.XRTYPE_VR);\n        this.app.fire(available ? this.availableEvent : this.unavailableEvent);\n    }\n};\n\n\n","// events-keyboard.js\nvar EventsKeyboard = pc.createScript('eventsKeyboard');\n\nEventsKeyboard.attributes.add('keys', {\n    type: 'json',\n    schema: [{\n        name: 'key',\n        type: 'number',\n        enum: [\n            { 'BACKSPACE': 8 },\n            { 'TAB': 9 },\n            { 'ENTER': 13 },\n            { 'ESCAPE': 27 },\n            { 'SPACE': 32 },\n            { 'ARROW UP': 38 },\n            { 'ARROW DOWN': 40 },\n            { 'ARROW LEFT': 37 },\n            { 'ARROW RIGHT': 39 },\n            { '0': 48 },\n            { '1': 49 },\n            { '2': 50 },\n            { '3': 51 },\n            { '4': 52 },\n            { '5': 53 },\n            { '6': 54 },\n            { '7': 55 },\n            { '8': 56 },\n            { '9': 57 },\n            { 'A': 65 },\n            { 'B': 66 },\n            { 'C': 67 },\n            { 'D': 68 },\n            { 'E': 69 },\n            { 'F': 70 },\n            { 'G': 71 },\n            { 'H': 72 },\n            { 'I': 73 },\n            { 'J': 74 },\n            { 'K': 75 },\n            { 'L': 76 },\n            { 'M': 77 },\n            { 'N': 78 },\n            { 'O': 79 },\n            { 'P': 80 },\n            { 'Q': 81 },\n            { 'R': 82 },\n            { 'S': 83 },\n            { 'T': 84 },\n            { 'U': 85 },\n            { 'V': 86 },\n            { 'W': 87 },\n            { 'X': 88 },\n            { 'Y': 89 },\n            { 'Z': 90 }\n        ],\n        title: 'Key',\n        description: 'The keyboard key that will fire events'\n    }, {\n        name: 'keyDownEvent',\n        type: 'string',\n        title: 'Key Down Event',\n        description: 'The event fired when the specified key is pressed'\n    }, {\n        name: 'keyRepeatEvent',\n        type: 'string',\n        title: 'Key Repeat Event',\n        description: 'The event fired when the specified key registers a repeat press after the initial press'\n    }, {\n        name: 'keyUpEvent',\n        type: 'string',\n        title: 'Key Up Event',\n        description: 'The event fired when the specified key is released'\n    }],\n    array: true,\n    title: 'Keys',\n    description: 'The set of keyboard keys that are configured to fire events'\n});\n\nEventsKeyboard.prototype.initialize = function () {\n    var app = this.app;\n\n    var keyDown = function (e) {\n        this.keys.forEach(function (key) {\n            if (key.key === e.keyCode) {\n                if (e.repeat && (key.keyRepeatEvent.length > 0)) {\n                    app.fire(key.keyRepeatEvent, 1);\n                } else if (!e.repeat && (key.keyDownEvent.length > 0)) {\n                    app.fire(key.keyDownEvent, 1);\n                }\n            }\n        });\n    }.bind(this);\n\n    var keyUp = function (e) {\n        this.keys.forEach(function (key) {\n            if ((key.key === e.keyCode) && (key.keyUpEvent.length > 0)) {\n                app.fire(key.keyUpEvent, 0);\n            }\n        });\n    }.bind(this);\n\n    // Manage DOM event listeners\n    var addEventListeners = function () {\n        window.addEventListener('keydown', keyDown, true);\n        window.addEventListener('keyup', keyUp, true);\n    };\n    var removeEventListeners = function () {\n        window.addEventListener('keydown', keyDown, true);\n        window.addEventListener('keyup', keyUp, true);\n    };\n\n    this.on('enable', addEventListeners);\n    this.on('disable', removeEventListeners);\n\n    this.on('destroy', removeEventListeners);\n\n    addEventListeners();\n};\n\n\n","// action-vr.js\nvar ActionVr = pc.createScript('actionVr');\n\nActionVr.attributes.add('startEvent', {\n    type: 'string',\n    title: 'Start Event',\n    description: 'Event that starts the VR session.'\n});\nActionVr.attributes.add('endEvent', {\n    type: 'string',\n    title: 'End Event',\n    description: 'Event that ends the VR session.'\n});\nActionVr.attributes.add('space', {\n    type: 'number',\n    enum: [\n        { 'Bounded Floor': 0 },\n        { 'Local': 1 },\n        { 'Local Floor': 2 },\n        { 'Unbounded': 3 },\n        { 'Viewer': 4 }\n    ],\n    default: 1,\n    title: 'Space',\n    description: 'The tracking space for the VR session.'\n});\n\nActionVr.prototype.startVr = function() {\n    var spaces = [\n        pc.XRSPACE_BOUNDEDFLOOR,\n        pc.XRSPACE_LOCAL,\n        pc.XRSPACE_LOCALFLOOR,\n        pc.XRSPACE_UNBOUNDED,\n        pc.XRSPACE_VIEWER\n    ];\n\n    if (!this.app.xr.supported) {\n        // WebXR is not supported\n        return;\n    }\n\n    if (this.app.xr.active) {\n        // session already active\n        return;\n    }\n\n    if (! this.app.xr.isAvailable(pc.XRTYPE_VR)) {\n        // this session type is not available\n        return;\n    }\n\n    // ask for motion permissions if we can\n    if (window.DeviceOrientationEvent && window.DeviceOrientationEvent.requestPermission) {\n        DeviceOrientationEvent.requestPermission().then(\n            function(response) {\n                if (response == 'granted') {\n                    window.addEventListener('deviceorientation', function (e) {\n                        // start session\n                        this.entity.camera.startXr(pc.XRTYPE_VR, spaces[this.space]);\n                    }.bind(this));\n                }\n            }.bind(this)).catch(console.error);\n    } else {\n        // start session\n        this.entity.camera.startXr(pc.XRTYPE_VR, spaces[this.space]);\n    }\n};\n\nActionVr.prototype.endVr = function() {\n    this.app.xr.end();\n};\n\n// initialize code called once per entity\nActionVr.prototype.initialize = function() {\n    if (this.startEvent && this.startEvent.length > 0) {\n        this.app.on(this.startEvent, this.startVr, this);\n    }\n    if (this.endEvent && this.endEvent.length > 0) {\n        this.app.on(this.endEvent, this.endVr, this);\n    }\n\n    this.on('attr:startEvent', function (value, prev) {\n        if (prev && prev.length > 0) {\n            app.off(prev, this.startVr, this);\n        }\n        if (value && value.length > 0) {\n            app.on(value, this.startVr, this);\n        }\n    });\n\n    this.on('attr:endEvent', function (value, prev) {\n        if (prev && prev.length > 0) {\n            app.off(prev, this.endVr, this);\n        }\n        if (value && value.length > 0) {\n            app.on(value, this.endVr, this);\n        }\n    });\n    \n    this.on('destroy', function () {\n        if (this.startEvent && this.startEvent.length > 0) {\n            this.app.off(this.startEvent, this.startVr, this);\n        }\n        if (this.endEvent && this.endEvent.length > 0) {\n            this.app.off(this.endEvent, this.endVr, this);\n        }\n    });\n};\n\n\n","// action-set-property.js\nvar ActionSetBoolean = pc.createScript('actionSetBoolean');\n\nActionSetBoolean.attributes.add('actions', {\n    type: 'json',\n    schema: [\n        {\n            name: 'event',\n            title: 'Event',\n            description: 'The event name that triggers this set action.',\n            type: 'string'\n        }, {\n            name: 'entity',\n            title: 'Entity',\n            description: 'The entity from where the path starts. If unset, this entity is used.',\n            type: 'entity'\n        }, {\n            name: 'path',\n            title: 'Path',\n            description: 'The path to set when the event fires.',\n            type: 'string'\n        }, {\n            name: 'value',\n            title: 'Value',\n            type: 'number',\n            enum: [\n                { 'False': 0 },\n                { 'True': 1 }\n            ],\n            description: 'The value to set the property to.',\n            default: 1\n        }\n    ],\n    array: true\n});\n\n// initialize code called once per entity\nActionSetBoolean.prototype.initialize = function() {\n    this.actions.forEach(function (action) {\n        this.app.on(action.event, function () {\n            var pathSegments = action.path.split('.');\n            var propertyOwner = action.entity ? action.entity : this.entity;\n            for (var i = 0; i < pathSegments.length - 1; i++) {\n                propertyOwner = propertyOwner[pathSegments[i]];\n            }\n\n            var propertyName = pathSegments[pathSegments.length - 1];\n            propertyOwner[propertyName] = !!action.value;\n        }, this);\n    }, this);\n};\n\n\n","// first-person-camera.js\n////////////////////////////////////////////////////////////////////////////////\r\n//                      First Person Character Controller                     //\r\n////////////////////////////////////////////////////////////////////////////////\r\nvar CharacterController = pc.createScript('characterController');\r\n\r\nCharacterController.attributes.add('speed', { type: 'number', default: 5 });\r\nCharacterController.attributes.add('jumpImpulse', { type: 'number', default: 400 });\r\n\r\n// initialize code called once per entity\r\nCharacterController.prototype.initialize = function () {\r\n    this.groundCheckRay = new pc.Vec3(0, -1.2, 0);\r\n    this.rayEnd = new pc.Vec3();\r\n\r\n    this.groundNormal = new pc.Vec3();\r\n    this.onGround = true;\r\n    this.jumping = false;\r\n};\r\n\r\nCharacterController.prototype.move = function (direction) {\r\n    if (this.onGround && !this.jumping) {\r\n        var tmp = new pc.Vec3();\r\n\r\n        var length = direction.length();\r\n        if (length > 0) {\r\n            // calculate new forward vec parallel to the current ground surface\r\n            tmp.cross(this.groundNormal, direction).cross(tmp, this.groundNormal);\r\n            tmp.normalize().scale(length * this.speed);\r\n        }\r\n        this.entity.rigidbody.linearVelocity = tmp;\r\n    }\r\n};\r\n\r\nCharacterController.prototype.jump = function () {\r\n    if (this.onGround && !this.jumping) {\r\n        this.entity.rigidbody.applyImpulse(0, this.jumpImpulse, 0);\r\n        this.onGround = false;\r\n        this.jumping = true;\r\n        setTimeout(function () {\r\n            this.jumping = false;\r\n        }.bind(this), 500);\r\n    }\r\n};\r\n\r\n// update code called every frame\r\nCharacterController.prototype.update = function (dt) {\r\n    var pos = this.entity.getPosition();\r\n    this.rayEnd.add2(pos, this.groundCheckRay);\r\n\r\n    // Fire a ray straight down to just below the bottom of the rigid body,\r\n    // if it hits something then the character is standing on something.\r\n    var result = this.app.systems.rigidbody.raycastFirst(pos, this.rayEnd);\r\n    this.onGround = !!result;\r\n    if (result) {\r\n        this.groundNormal.copy(result.normal);\r\n    }\r\n};\r\n\r\n\r\n////////////////////////////////////////////////////////////////////////////////\r\n//         First Person Controls That Drive a Character Controller            //\r\n////////////////////////////////////////////////////////////////////////////////\r\nvar FirstPersonCamera = pc.createScript('firstPersonCamera');\r\n\r\nFirstPersonCamera.attributes.add('camera', {\r\n    title: 'Camera',\r\n    description: 'The camera controlled by this first person view. It should be a child of the entity to which this script is assigned. If no camera is assigned, the script will create one for you.',\r\n    type: 'entity'\r\n});\r\n\r\nFirstPersonCamera.prototype.initialize = function () {\r\n    var app = this.app;\r\n\r\n    // Check the user has set a camera entity for the FPS view\r\n    if (!this.camera) {\r\n        // If not look for a chile of the character controller called 'Camera'\r\n        this.camera = this.entity.findByName('Camera');\r\n        if (!this.camera) {\r\n            // Still don't have a camera so just create one!\r\n            this.camera = new pc.Entity('FPS Camera');\r\n            this.camera.addComponent('camera');\r\n        }\r\n    }\r\n\r\n    this.x = new pc.Vec3();\r\n    this.z = new pc.Vec3();\r\n    this.heading = new pc.Vec3();\r\n    this.magnitude = new pc.Vec2();\r\n\r\n    this.azimuth = 0;\r\n    this.elevation = 0;\r\n\r\n    // Calculate camera azimuth/elevation\r\n    var temp = this.camera.forward.clone();\r\n    temp.y = 0;\r\n    temp.normalize();\r\n    this.azimuth = Math.atan2(-temp.x, -temp.z) * (180 / Math.PI);\r\n\r\n    var rot = new pc.Mat4().setFromAxisAngle(pc.Vec3.UP, -this.azimuth);\r\n    rot.transformVector(this.camera.forward, temp);\r\n    this.elevation = Math.atan(temp.y, temp.z) * (180 / Math.PI);\r\n\r\n    this.forward = 0;\r\n    this.strafe = 0;\r\n    this.jump = false;\r\n    this.cnt = 0;\r\n\r\n    app.on('firstperson:forward', function (value) {\r\n        this.forward = value;\r\n    }, this);\r\n    app.on('firstperson:strafe', function (value) {\r\n        this.strafe = value;\r\n    }, this);\r\n    app.on('firstperson:look', function (azimuthDelta, elevationDelta) {\r\n        this.azimuth += azimuthDelta;\r\n        this.elevation += elevationDelta;\r\n        this.elevation = pc.math.clamp(this.elevation, -90, 90);\r\n    }, this);\r\n    app.on('firstperson:jump', function () {\r\n        this.jump = true;\r\n    }, this);\r\n};\r\n\r\nFirstPersonCamera.prototype.postUpdate = function (dt) {\r\n    // Update the camera's orientation\r\n    this.camera.setEulerAngles(this.elevation, this.azimuth, 0);\r\n\r\n    // Calculate the camera's heading in the XZ plane\r\n    this.z.copy(this.camera.forward);\r\n    this.z.y = 0;\r\n    this.z.normalize();\r\n\r\n    this.x.copy(this.camera.right);\r\n    this.x.y = 0;\r\n    this.x.normalize();\r\n\r\n    this.heading.set(0, 0, 0);\r\n\r\n    // Move forwards/backwards\r\n    if (this.forward !== 0) {\r\n        this.z.scale(this.forward);\r\n        this.heading.add(this.z);\r\n    }\r\n\r\n    // Strafe left/right\r\n    if (this.strafe !== 0) {\r\n        this.x.scale(this.strafe);\r\n        this.heading.add(this.x);\r\n    }\r\n\r\n    if (this.heading.length() > 0.0001) {\r\n        this.magnitude.set(this.forward, this.strafe);\r\n        this.heading.normalize().scale(this.magnitude.length());\r\n    }\r\n\r\n    if (this.jump) {\r\n        this.entity.script.characterController.jump();\r\n        this.jump = false;\r\n    }\r\n\r\n    this.entity.script.characterController.move(this.heading);\r\n\r\n    var pos = this.camera.getPosition();\r\n    this.app.fire('cameramove', pos);\r\n};\r\n\r\n\r\n////////////////////////////////////////////////////////////////////////////////\r\n//  FPS Keyboard Controls (Movement Only - Work Alongside Mouse Look Script)  //\r\n////////////////////////////////////////////////////////////////////////////////\r\nvar KeyboardInput = pc.createScript('keyboardInput');\r\n\r\nKeyboardInput.prototype.initialize = function () {\r\n    var app = this.app;\r\n\r\n    var updateMovement = function (keyCode, value) {\r\n        switch (keyCode) {\r\n            case 38: // Up arrow\r\n            case 87: // W\r\n                app.fire('firstperson:forward', value);\r\n                break;\r\n            case 40: // Down arrow\r\n            case 83: // S\r\n                app.fire('firstperson:forward', -value);\r\n                break;\r\n            case 37: // Left arrow\r\n            case 65: // A\r\n                app.fire('firstperson:strafe', -value);\r\n                break;\r\n            case 39: // Right arrow\r\n            case 68: // D\r\n                app.fire('firstperson:strafe', value);\r\n                break;\r\n        }\r\n    };\r\n\r\n    var keyDown = function (e) {\r\n        if (!e.repeat) {\r\n            updateMovement(e.keyCode, 1);\r\n\r\n            if (e.keyCode === 32) { // Space\r\n                app.fire('firstperson:jump');\r\n            }\r\n        }\r\n    };\r\n\r\n    var keyUp = function (e) {\r\n        updateMovement(e.keyCode, 0);\r\n    };\r\n\r\n    // Manage DOM event listeners\r\n    var addEventListeners = function () {\r\n        window.addEventListener('keydown', keyDown, true);\r\n        window.addEventListener('keyup', keyUp, true);\r\n    };\r\n    var removeEventListeners = function () {\r\n        window.addEventListener('keydown', keyDown, true);\r\n        window.addEventListener('keyup', keyUp, true);\r\n    };\r\n\r\n    this.on('enable', addEventListeners);\r\n    this.on('disable', removeEventListeners);\r\n\r\n    addEventListeners();\r\n};\r\n\r\n\r\n////////////////////////////////////////////////////////////////////////////////\r\n//                         FPS Mouse Look Controls                            //\r\n////////////////////////////////////////////////////////////////////////////////\r\nvar MouseInput = pc.createScript('mouseInput');\r\n\r\nMouseInput.prototype.initialize = function () {\r\n    var app = this.app;\r\n    var canvas = app.graphicsDevice.canvas;\r\n\r\n    var mouseDown = function (e) {\r\n        if (document.pointerLockElement !== canvas && canvas.requestPointerLock) {\r\n            canvas.requestPointerLock();\r\n        }\r\n    };\r\n\r\n    var mouseMove = function (e) {\r\n        if (document.pointerLockElement === canvas) {\r\n            var movementX = e.movementX || e.webkitMovementX || e.mozMovementX || 0;\r\n            var movementY = e.movementY || e.webkitMovementY || e.mozMovementY || 0;\r\n\r\n            app.fire('firstperson:look', -movementX / 5, -movementY / 5);\r\n        }\r\n    };\r\n\r\n    // Manage DOM event listeners\r\n    var addEventListeners = function () {\r\n        window.addEventListener('mousedown', mouseDown, false);\r\n        window.addEventListener('mousemove', mouseMove, false);\r\n    };\r\n    var removeEventListeners = function () {\r\n        window.removeEventListener('mousedown', mouseDown, false);\r\n        window.removeEventListener('mousemove', mouseMove, false);\r\n    };\r\n\r\n    this.on('enable', addEventListeners);\r\n    this.on('disable', removeEventListeners);\r\n\r\n    addEventListeners();\r\n};\r\n\r\n// Utility function for both touch and gamepad handling of deadzones\r\n// Takes a 2-axis joystick position in the range -1 to 1 and applies\r\n// an upper and lower radial deadzone, remapping values in the legal\r\n// range from 0 to 1.\r\nfunction applyRadialDeadZone(pos, remappedPos, deadZoneLow, deadZoneHigh) {\r\n    var magnitude = pos.length();\r\n\r\n    if (magnitude > deadZoneLow) {\r\n        var legalRange = 1 - deadZoneHigh - deadZoneLow;\r\n        var normalizedMag = Math.min(1, (magnitude - deadZoneLow) / legalRange);\r\n        var scale = normalizedMag / magnitude;\r\n        remappedPos.copy(pos).scale(scale);\r\n    } else {\r\n        remappedPos.set(0, 0);\r\n    }\r\n}\r\n\r\n////////////////////////////////////////////////////////////////////////////////\r\n//                 Dual Virtual Stick FPS Touch Controls                      //\r\n////////////////////////////////////////////////////////////////////////////////\r\nvar TouchInput = pc.createScript('touchInput');\r\n\r\nTouchInput.attributes.add('deadZone', {\r\n    title: 'Dead Zone',\r\n    description: 'Radial thickness of inner dead zone of the virtual joysticks. This dead zone ensures the virtual joysticks report a value of 0 even if a touch deviates a small amount from the initial touch.',\r\n    type: 'number',\r\n    min: 0,\r\n    max: 0.4,\r\n    default: 0.3\r\n});\r\nTouchInput.attributes.add('turnSpeed', {\r\n    title: 'Turn Speed',\r\n    description: 'Maximum turn speed in degrees per second',\r\n    type: 'number',\r\n    default: 150\r\n});\r\nTouchInput.attributes.add('radius', {\r\n    title: 'Radius',\r\n    description: 'The radius of the virtual joystick in CSS pixels.',\r\n    type: 'number',\r\n    default: 50\r\n});\r\nTouchInput.attributes.add('doubleTapInterval', {\r\n    title: 'Double Tap Interval',\r\n    description: 'The time in milliseconds between two taps of the right virtual joystick for a double tap to register. A double tap will trigger a jump.',\r\n    type: 'number',\r\n    default: 300\r\n});\r\n\r\nTouchInput.prototype.initialize = function () {\r\n    var app = this.app;\r\n    var graphicsDevice = app.graphicsDevice;\r\n    var canvas = graphicsDevice.canvas;\r\n\r\n    this.remappedPos = new pc.Vec2();\r\n\r\n    this.leftStick = {\r\n        identifier: -1,\r\n        center: new pc.Vec2(),\r\n        pos: new pc.Vec2()\r\n    };\r\n    this.rightStick = {\r\n        identifier: -1,\r\n        center: new pc.Vec2(),\r\n        pos: new pc.Vec2()\r\n    };\r\n\r\n    this.lastRightTap = 0;\r\n\r\n    var touchStart = function (e) {\r\n        e.preventDefault();\r\n\r\n        var xFactor = graphicsDevice.width / canvas.clientWidth;\r\n        var yFactor = graphicsDevice.height / canvas.clientHeight;\r\n\r\n        var touches = e.changedTouches;\r\n        for (var i = 0; i < touches.length; i++) {\r\n            var touch = touches[i];\r\n\r\n            if (touch.pageX <= canvas.clientWidth / 2 && this.leftStick.identifier === -1) {\r\n                // If the user touches the left half of the screen, create a left virtual joystick...\r\n                this.leftStick.identifier = touch.identifier;\r\n                this.leftStick.center.set(touch.pageX, touch.pageY);\r\n                this.leftStick.pos.set(0, 0);\r\n                app.fire('leftjoystick:enable', touch.pageX * xFactor, touch.pageY * yFactor);\r\n            } else if (touch.pageX > canvas.clientWidth / 2 && this.rightStick.identifier === -1) {\r\n                // ...otherwise create a right virtual joystick\r\n                this.rightStick.identifier = touch.identifier;\r\n                this.rightStick.center.set(touch.pageX, touch.pageY);\r\n                this.rightStick.pos.set(0, 0);\r\n                app.fire('rightjoystick:enable', touch.pageX * xFactor, touch.pageY * yFactor);\r\n\r\n                // See how long since the last tap of the right virtual joystick to detect a double tap (jump)\r\n                var now = Date.now();\r\n                if (now - this.lastRightTap < this.doubleTapInterval) {\r\n                    app.fire('firstperson:jump');\r\n                }\r\n                this.lastRightTap = now;\r\n            }\r\n        }\r\n    }.bind(this);\r\n\r\n    var touchMove = function (e) {\r\n        e.preventDefault();\r\n\r\n        var xFactor = graphicsDevice.width / canvas.clientWidth;\r\n        var yFactor = graphicsDevice.height / canvas.clientHeight;\r\n\r\n        var touches = e.changedTouches;\r\n        for (var i = 0; i < touches.length; i++) {\r\n            var touch = touches[i];\r\n\r\n            // Update the current positions of the two virtual joysticks\r\n            if (touch.identifier === this.leftStick.identifier) {\r\n                this.leftStick.pos.set(touch.pageX, touch.pageY);\r\n                this.leftStick.pos.sub(this.leftStick.center);\r\n                this.leftStick.pos.scale(1 / this.radius);\r\n                app.fire('leftjoystick:move', touch.pageX * xFactor, touch.pageY * yFactor);\r\n            } else if (touch.identifier === this.rightStick.identifier) {\r\n                this.rightStick.pos.set(touch.pageX, touch.pageY);\r\n                this.rightStick.pos.sub(this.rightStick.center);\r\n                this.rightStick.pos.scale(1 / this.radius);\r\n                app.fire('rightjoystick:move', touch.pageX * xFactor, touch.pageY * yFactor);\r\n            }\r\n        }\r\n    }.bind(this);\r\n\r\n    var touchEnd = function (e) {\r\n        e.preventDefault();\r\n\r\n        var touches = e.changedTouches;\r\n        for (var i = 0; i < touches.length; i++) {\r\n            var touch = touches[i];\r\n\r\n            // If this touch is one of the sticks, get rid of it...\r\n            if (touch.identifier === this.leftStick.identifier) {\r\n                this.leftStick.identifier = -1;\r\n                app.fire('firstperson:forward', 0);\r\n                app.fire('firstperson:strafe', 0);\r\n                app.fire('leftjoystick:disable');\r\n            } else if (touch.identifier === this.rightStick.identifier) {\r\n                this.rightStick.identifier = -1;\r\n                app.fire('rightjoystick:disable');\r\n            }\r\n        }\r\n    }.bind(this);\r\n\r\n    // Manage DOM event listeners\r\n    var addEventListeners = function () {\r\n        canvas.addEventListener('touchstart', touchStart, false);\r\n        canvas.addEventListener('touchmove', touchMove, false);\r\n        canvas.addEventListener('touchend', touchEnd, false);\r\n    };\r\n    var removeEventListeners = function () {\r\n        canvas.removeEventListener('touchstart', touchStart, false);\r\n        canvas.removeEventListener('touchmove', touchMove, false);\r\n        canvas.removeEventListener('touchend', touchEnd, false);\r\n    };\r\n\r\n    this.on('enable', addEventListeners);\r\n    this.on('disable', removeEventListeners);\r\n\r\n    addEventListeners();\r\n};\r\n\r\nTouchInput.prototype.update = function (dt) {\r\n    var app = this.app;\r\n\r\n    // Moving\r\n    if (this.leftStick.identifier !== -1) {\r\n        // Apply a lower radial dead zone. We don't need an upper zone like with a real joypad\r\n        applyRadialDeadZone(this.leftStick.pos, this.remappedPos, this.deadZone, 0);\r\n\r\n        var strafe = this.remappedPos.x;\r\n        if (this.lastStrafe !== strafe) {\r\n            app.fire('firstperson:strafe', strafe);\r\n            this.lastStrafe = strafe;\r\n        }\r\n        var forward = -this.remappedPos.y;\r\n        if (this.lastForward !== forward) {\r\n            app.fire('firstperson:forward', forward);\r\n            this.lastForward = forward;\r\n        }\r\n    }\r\n\r\n    // Looking\r\n    if (this.rightStick.identifier !== -1) {\r\n        // Apply a lower radial dead zone. We don't need an upper zone like with a real joypad\r\n        applyRadialDeadZone(this.rightStick.pos, this.remappedPos, this.deadZone, 0);\r\n\r\n        var lookLeftRight = -this.remappedPos.x * this.turnSpeed * dt;\r\n        var lookUpDown = -this.remappedPos.y * this.turnSpeed * dt;\r\n        app.fire('firstperson:look', lookLeftRight, lookUpDown);\r\n    }\r\n};\r\n\r\n\r\n////////////////////////////////////////////////////////////////////////////////\r\n//                 Dual Analog Stick FPS Gamepad Controls                     //\r\n////////////////////////////////////////////////////////////////////////////////\r\nvar GamePadInput = pc.createScript('gamePadInput');\r\n\r\nGamePadInput.attributes.add('deadZoneLow', {\r\n    title: 'Low Dead Zone',\r\n    description: 'Radial thickness of inner dead zone of pad\\'s joysticks. This dead zone ensures that all pads report a value of 0 for each joystick axis when untouched.',\r\n    type: 'number',\r\n    min: 0,\r\n    max: 0.4,\r\n    default: 0.2\r\n});\r\nGamePadInput.attributes.add('deadZoneHigh', {\r\n    title: 'High Dead Zone',\r\n    description: 'Radial thickness of outer dead zone of pad\\'s joysticks. This dead zone ensures that all pads can reach the -1 and 1 limits of each joystick axis.',\r\n    type: 'number',\r\n    min: 0,\r\n    max: 0.4,\r\n    default: 0.2\r\n});\r\nGamePadInput.attributes.add('turnSpeed', {\r\n    title: 'Turn Speed',\r\n    description: 'Maximum turn speed in degrees per second',\r\n    type: 'number',\r\n    default: 150\r\n});\r\n\r\nGamePadInput.prototype.initialize = function () {\r\n    this.lastStrafe = 0;\r\n    this.lastForward = 0;\r\n    this.lastJump = false;\r\n\r\n    this.remappedPos = new pc.Vec2();\r\n\r\n    this.leftStick = {\r\n        center: new pc.Vec2(),\r\n        pos: new pc.Vec2()\r\n    };\r\n    this.rightStick = {\r\n        center: new pc.Vec2(),\r\n        pos: new pc.Vec2()\r\n    };\r\n\r\n    // Manage DOM event listeners\r\n    var addEventListeners = function () {\r\n        window.addEventListener(\"gamepadconnected\", function (e) {});\r\n        window.addEventListener(\"gamepaddisconnected\", function (e) {});\r\n    };\r\n    var removeEventListeners = function () {\r\n        window.removeEventListener(\"gamepadconnected\", function (e) {});\r\n        window.removeEventListener(\"gamepaddisconnected\", function (e) {});\r\n    };\r\n\r\n    this.on('enable', addEventListeners);\r\n    this.on('disable', removeEventListeners);\r\n\r\n    addEventListeners();\r\n};\r\n\r\nGamePadInput.prototype.update = function (dt) {\r\n    var app = this.app;\r\n\r\n    var gamepads = navigator.getGamepads ? navigator.getGamepads() : [];\r\n\r\n    for (var i = 0; i < gamepads.length; i++) {\r\n        var gamepad = gamepads[i];\r\n\r\n        // Only proceed if we have at least 2 sticks\r\n        if (gamepad && gamepad.mapping === 'standard' && gamepad.axes.length >= 4) {\r\n            // Moving (left stick)\r\n            this.leftStick.pos.set(gamepad.axes[0], gamepad.axes[1]);\r\n            applyRadialDeadZone(this.leftStick.pos, this.remappedPos, this.deadZoneLow, this.deadZoneHigh);\r\n\r\n            var strafe = this.remappedPos.x;\r\n            if (this.lastStrafe !== strafe) {\r\n                app.fire('firstperson:strafe', strafe);\r\n                this.lastStrafe = strafe;\r\n            }\r\n            var forward = -this.remappedPos.y;\r\n            if (this.lastForward !== forward) {\r\n                app.fire('firstperson:forward', forward);\r\n                this.lastForward = forward;\r\n            }\r\n\r\n            // Looking (right stick)\r\n            this.rightStick.pos.set(gamepad.axes[2], gamepad.axes[3]);\r\n            applyRadialDeadZone(this.rightStick.pos, this.remappedPos, this.deadZoneLow, this.deadZoneHigh);\r\n\r\n            var lookLeftRight = -this.remappedPos.x * this.turnSpeed * dt;\r\n            var lookUpDown = -this.remappedPos.y * this.turnSpeed * dt;\r\n            app.fire('firstperson:look', lookLeftRight, lookUpDown);\r\n\r\n            // Jumping (bottom button of right cluster)\r\n            if (gamepad.buttons[0].pressed && !this.lastJump) {\r\n                app.fire('firstperson:jump');\r\n            }\r\n            this.lastJump = gamepad.buttons[0].pressed;\r\n        }\r\n    }\r\n};\r\n\n\n"]}